<?php

declare(strict_types=1);

namespace App\Command;

use App\Entity\Contract;
use Doctrine\ORM\EntityManagerInterface;
use GuzzleHttp\Client as GuzzleClient;
use League\Uri\Modifiers\AppendSegment;
use League\Uri\Schemes\Http as HttpUri;
use Symfony\Component\Console\Command\Command;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Input\InputOption;
use Symfony\Component\Console\Output\OutputInterface;
use Symfony\Component\Console\Style\SymfonyStyle;

class PatchContractLockInDateFromExpiryDate extends Command
{
    /**
     * @var EntityManagerInterface
     */
    private $entityManager;

    /**
     * @var string
     */
    private $documentConverterHost;

    /**
     * @var \DateTimeZone
     */
    private $timezone;

    /**
     * @param EntityManagerInterface $entityManager
     * @param string                 $documentConverterHost
     * @param string                 $timezone
     */
    public function __construct(EntityManagerInterface $entityManager, string $documentConverterHost, string $timezone)
    {
        parent::__construct();

        $this->entityManager = $entityManager;
        $this->documentConverterHost = $documentConverterHost;
        $this->timezone = new \DateTimeZone($timezone);
    }

    /**
     * {@inheritdoc}
     */
    protected function configure(): void
    {
        $this
            ->setName('app:patch:contract-lock-in-date')
            ->setDescription('Updates lock in date from expiry date in status xml file.')
            ->addOption('file-url', null, InputOption::VALUE_REQUIRED, 'Url of file', null)
            ->setHelp(<<<'EOF'
The %command.name% command to patch contract lock in date from status file.
EOF
            )
        ;
    }

    /**
     * {@inheritdoc}
     */
    protected function execute(InputInterface $input, OutputInterface $output): ?int
    {
        $io = new SymfonyStyle($input, $output);

        $fileUrl = $input->getOption('file-url');

        if (null !== $fileUrl) {
            $tempFile = \tmpfile();
            $curl = \curl_init();
            \curl_setopt($curl, CURLOPT_URL, $fileUrl);
            \curl_setopt($curl, CURLOPT_FILE, $tempFile);
            \curl_exec($curl);
            \curl_close($curl);
        } else {
            $io->error('No file specified');

            return 0;
        }

        $baseUri = HttpUri::createFromString($this->documentConverterHost);
        $modifier = new AppendSegment('application_requests/xml/contract_application');
        $uri = $modifier->process($baseUri);

        $client = new GuzzleClient();
        $multipartContent = [
            'headers' => [
                'User-Agent' => 'U-Centric API',
            ],
            'multipart' => [
                [
                    'name' => 'file',
                    'filename' => \uniqid().'.xml',
                    'contents' => $tempFile,
                ],
            ],
        ];

        if (\filesize(\stream_get_meta_data($tempFile)['uri']) > 0) {
            $io->text('Uploading to document converter...');
            $uploadResponse = $client->request('POST', $uri, $multipartContent);
            $uploadResult = \json_decode((string) $uploadResponse->getBody(), true);

            $toPatch = [
                'SW1900678678',
                'SW1900718856',
                'SW1900685378',
                'SW1900705490',
                'SW1900718789',
                'SW1900695878',
                'SW1900718678',
                'SW1900691434',
                'SW1900681256',
                'SW1900695578',
                'SW1900682701',
                'SW1900685101',
                'SW1900674256',
                'SW1900676245',
                'SW1900684301',
                'SW1900717412',
                'SW1900696478',
                'SW1900707112',
                'SW1900695512',
                'SW1900684801',
                'SW1900688090',
                'SW1900705223',
                'SW1900718301',
                'SW1900692101',
                'SW1900704867',
                'SW1900705212',
                'SW1900695867',
                'SW1900686301',
                'SW1900696167',
                'SW1900685701',
                'SW1900682223',
                'SW1900686834',
                'SW1900718690',
                'SW1900684590',
                'SW1900686290',
                'SW1900686201',
                'SW1900688601',
                'SW1900706590',
                'SW1900688589',
                'SW1900696323',
                'SW1900688156',
                'SW1900678645',
                'SW1900684434',
                'SW1900688434',
                'SW1900695889',
                'SW1900706656',
                'SW1900705234',
                'SW1900707256',
                'SW1900705989',
                'SW1900696578',
                'SW1900691445',
                'SW1900684423',
                'SW1900686101',
                'SW1900717489',
                'SW1900682534',
                'SW1900707567',
                'SW1900704367',
                'SW1900696523',
                'SW1900679067',
                'SW1900693512',
                'SW1900705245',
                'SW1900682490',
                'SW1900707445',
                'SW1900686178',
                'SW1900691189',
                'SW1900688390',
                'SW1900705523',
                'SW1900685089',
                'SW1900706601',
                'SW1900705623',
                'SW1900686423',
                'SW1900684412',
                'SW1900689390',
                'SW1900717590',
                'SW1900696101',
                'SW1900689323',
                'SW1900682290',
                'SW1900707223',
                'SW1900688045',
                'SW1900679078',
                'SW1900705723',
                'SW1900684634',
                'SW1900717567',
                'SW1900688412',
                'SW1900682390',
                'SW1900685534',
                'SW1900682378',
                'SW1900695389',
                'SW1900707367',
                'SW1900678590',
                'SW1900681378',
                'SW1900691490',
                'SW1900678845',
                'SW1900682690',
                'SW1900696201',
                'SW1900705301',
                'SW1900686967',
                'SW1900686656',
                'SW1900679045',
                'SW1900684489',
                'SW1900717678',
                'SW1900681201',
                'SW1900695401',
                'SW1900684534',
                'SW1900679345',
                'SW1900707656',
                'SW1900691278',
                'SW1900686490',
                'SW1900685156',
                'SW1900684490',
                'SW1900684601',
                'SW1900678801',
                'SW1900688534',
                'SW1900679334',
                'SW1900685934',
                'SW1900707178',
                'SW1900691290',
                'SW1900682356',
                'SW1900680401',
                'SW1900684767',
                'SW1900684878',
                'SW1900706001',
                'SW1900695712',
                'SW1900678634',
                'SW1900704812',
                'SW1900706812',
                'SW1900684356',
                'SW1900691812',
                'SW1900679245',
                'SW1900679056',
                'SW1900691578',
                'SW1900705678',
                'SW1900678934',
                'SW1900707134',
                'SW1900679223',
                'SW1900688012',
                'SW1900682567',
                'SW1900682501',
                'SW1900684623',
                'SW1900704356',
                'SW1900688078',
                'SW1900682345',
                'SW1900684823',
                'SW1900696045',
                'SW1900684478',
                'SW1900705889',
                'SW1900685212',
                'SW1900679378',
                'SW1900707190',
                'SW1900691478',
                'SW1900679201',
                'SW1900684289',
                'SW1900717445',
                'SW1900686956',
                'SW1900682678',
                'SW1900705390',
                'SW1900678690',
                'SW1900692023',
                'SW1900691778',
                'SW1900685512',
                'SW1900707056',
                'SW1900699001',
                'SW1900685290',
                'SW1900696467',
                'SW1900681267',
                'SW1900693590',
                'SW1900679301',
                'SW1900686289',
                'SW1900679289',
                'SW1900691878',
                'SW1900692056',
                'SW1900695701',
                'SW1900695790',
                'SW1900679323',
                'SW1900691790',
                'SW1900685756',
                'SW1900682790',
                'SW1900691056',
                'SW1900685490',
                'SW1900706256',
                'SW1900720845',
                'SW1900717523',
                'SW1900705145',
                'SW1900682401',
                'SW1900706889',
                'SW1900678789',
                'SW1900704756',
                'SW1900695523',
                'SW1900691556',
                'SW1900682445',
                'SW1900678601',
                'SW1900678612',
                'SW1900707145',
                'SW1900695723',
                'SW1900695845',
                'SW1900704967',
                'SW1900712390',
                'SW1900705401',
                'SW1900685723',
                'SW1900678623',
                'SW1900717323',
                'SW1900707678',
                'SW1900685134',
                'SW1900681389',
                'SW1900678890',
                'SW1900682489',
                'SW1900686267',
                'SW1900679134',
                'SW1900684034',
                'SW1900705156',
                'SW1900681101',
                'SW1900682590',
                'SW1900684789',
                'SW1900681334',
                'SW1900686067',
                'SW1900684167',
                'SW1900687189',
                'SW1900682578',
                'SW1900695923',
                'SW1900696123',
                'SW1900688345',
                'SW1900687001',
                'SW1900717512',
                'SW1900678745',
                'SW1900685456',
                'SW1900689401',
                'SW1900696190',
                'SW1900688578',
                'SW1900693589',
                'SW1900696356',
                'SW1900695434',
                'SW1900682478',
                'SW1900691312',
                'SW1900705712',
                'SW1900696612',
                'SW1900685312',
                'SW1900686556',
                'SW1900686934',
                'SW1900682778',
                'SW1900684890',
                'SW1900705778',
                'SW1900687123',
                'SW1900685489',
                'SW1900678823',
                'SW1900685812',
                'SW1900685623',
                'SW1900705567',
                'SW1900684045',
                'SW1900696023',
                'SW1900706878',
                'SW1900686356',
                'SW1900686945',
                'SW1900705012',
                'SW1900685978',
                'SW1900707712',
                'SW1900686812',
                'SW1900705923',
                'SW1900687178',
                'SW1900682656',
                'SW1900689389',
                'SW1900720890',
                'SW1900704434',
                'SW1900696445',
                'SW1900687101',
                'SW1900717401',
                'SW1900685301',
                'SW1900678878',
                'SW1900705856',
                'SW1900705767',
                'SW1900681356',
                'SW1900678978',
                'SW1900678701',
                'SW1900687134',
                'SW1900705067',
                'SW1900688556',
                'SW1900695801',
                'SW1900685201',
                'SW1900686078',
                'SW1900707067',
                'SW1900712445',
                'SW1900688567',
                'SW1900684501',
                'SW1900679190',
                'SW1900686478',
                'SW1900695990',
                'SW1900696067',
                'SW1900717389',
                'SW1900684223',
                'SW1900691412',
                'SW1900686245',
                'SW1900707101',
                'SW1900706445',
                'SW1900688323',
                'SW1900706589',
                'SW1900691389',
                'SW1900717601',
                'SW1900679278',
                'SW1900686912',
                'SW1900688256',
                'SW1900682367',
                'SW1900681323',
                'SW1900693567',
                'SW1900704901',
                'SW1900686489',
                'SW1900681278',
                'SW1900682278',
                'SW1900707356',
                'SW1900718245',
                'SW1900707390',
                'SW1900685578',
                'SW1900705489',
                'SW1900684978',
                'SW1900706356',
                'SW1900686467',
                'SW1900678778',
                'SW1900685423',
                'SW1900688034',
                'SW1900684090',
                'SW1900682612',
                'SW1900681401',
                'SW1900706967',
                'SW1900695856',
                'SW1900688512',
                'SW1900681423',
                'SW1900705823',
                'SW1900687990',
                'SW1900685945',
                'SW1900691890',
                'SW1900681112',
                'SW1900692089',
                'SW1900706767',
                'SW1900684812',
                'SW1900696590',
                'SW1900682467',
                'SW1900696367',
                'SW1900686190',
                'SW1900686523',
                'SW1900695589',
                'SW1900678912',
                'SW1900678545',
                'SW1900678956',
                'SW1900688623',
                'SW1900691212',
                'SW1900685545',
                'SW1900681289',
                'SW1900718645',
                'SW1900682589',
                'SW1900695789',
                'SW1900684989',
                'SW1900684612',
                'SW1900718778',
                'SW1900684234',
                'SW1900693601',
                'SW1900718234',
                'SW1900705312',
                'SW1900685034',
                'SW1900695567',
                'SW1900696089',
                'SW1900696567',
                'SW1900720867',
                'SW1900720889',
                'SW1900707412',
                'SW1900679023',
                'SW1900718689',
                'SW1900695778',
                'SW1900704656',
                'SW1900691523',
                'SW1900684745',
                'SW1900691234',
                'SW1900691367',
                'SW1900695634',
                'SW1900681212',
                'SW1900686667',
                'SW1900684145',
                'SW1900705190',
                'SW1900688145',
                'SW1900681123',
                'SW1900695412',
                'SW1900705689',
                'SW1900684067',
                'SW1900684889',
                'SW1900678856',
                'SW1900706667',
                'SW1900705167',
                'SW1900686589',
                'SW1900684312',
                'SW1900691245',
                'SW1900685334',
                'SW1900718767',
                'SW1900688545',
                'SW1900706401',
                'SW1900678689',
                'SW1900695689',
                'SW1900688056',
                'SW1900679256',
                'SW1900682712',
                'SW1900707245',
                'SW1900682823',
                'SW1900695978',
                'SW1900705267',
                'SW1900687078',
                'SW1900679156',
                'SW1900685167',
                'SW1900691989',
                'SW1900682745',
                'SW1900684778',
                'SW1900696078',
                'SW1900704989',
                'SW1900705256',
                'SW1900687012',
                'SW1900705756',
                'SW1900696156',
                'SW1900685056',
                'SW1900706012',
                'SW1900704790',
                'SW1900705978',
                'SW1900691845',
                'SW1900688190',
                'SW1900678834',
                'SW1900706823',
                'SW1900718812',
                'SW1900684245',
                'SW1900691901',
                'SW1900688389',
                'SW1900691390',
                'SW1900685012',
                'SW1900695390',
                'SW1900688201',
                'SW1900705501',
                'SW1900684290',
                'SW1900706690',
                'SW1900695956',
                'SW1900691423',
                'SW1900682389',
                'SW1900685389',
                'SW1900695645',
                'SW1900685834',
                'SW1900679101',
                'SW1900707478',
                'SW1900688312',
                'SW1900684389',
                'SW1900695945',
                'SW1900686145',
                'SW1900706501',
                'SW1900682634',
                'SW1900678667',
                'SW1900696534',
                'SW1900695534',
                'SW1900691856',
                'SW1900686578',
                'SW1900705578',
                'SW1900691456',
                'SW1900705045',
                'SW1900685001',
                'SW1900705834',
                'SW1900679178',
                'SW1900695612',
                'SW1900681434',
                'SW1900685634',
                'SW1900704678',
                'SW1900686623',
                'SW1900696189',
                'SW1900686001',
                'SW1900679012',
                'SW1900717301',
                'SW1900705023',
                'SW1900686690',
                'SW1900691990',
                'SW1900681167',
                'SW1900688234',
                'SW1900679212',
                'SW1900706912',
                'SW1900686134',
                'SW1900718734',
                'SW1900696212',
                'SW1900705545',
                'SW1900679290',
                'SW1900704467',
                'SW1900705034',
                'SW1900696301',
                'SW1900696178',
                'SW1900704934',
                'SW1900704389',
                'SW1900684112',
                'SW1900696012',
                'SW1900688334',
                'SW1900707023',
                'SW1900705812',
                'SW1900697623',
                'SW1900686634',
                'SW1900685189',
                'SW1900684867',
                'SW1900705590',
                'SW1900705878',
                'SW1900679089',
                'SW1900686701',
                'SW1900712434',
                'SW1900682667',
                'SW1900674778',
                'SW1900695989',
                'SW1900696312',
                'SW1900707623',
                'SW1900686501',
                'SW1900681345',
                'SW1900717501',
                'SW1900695678',
                'SW1900686223',
                'SW1900685245',
                'SW1900687167',
                'SW1900681156',
                'SW1900706456',
                'SW1900681078',
                'SW1900688167',
                'SW1900686234',
                'SW1900681467',
                'SW1900685734',
                'SW1900688001',
                'SW1900682645',
                'SW1900679090',
                'SW1900688089',
                'SW1900696378',
                'SW1900695901',
                'SW1900682256',
                'SW1900686990',
                'SW1900691789',
                'SW1900704956',
                'SW1900686534',
                'SW1900704945',
                'SW1900686189',
                'SW1900705378',
                'SW1900686367',
                'SW1900679034',
                'SW1900718312',
                'SW1900688267',
                'SW1900686434',
                'SW1900679312',
                'SW1900682323',
                'SW1900686390',
                'SW1900682689',
                'SW1900682245',
                'SW1900684390',
                'SW1900696245',
                'SW1900704923',
                'SW1900695623',
                'SW1900686256',
                'SW1900706490',
                'SW1900681412',
                'SW1900695767',
                'SW1900693556',
                'SW1900678767',
                'SW1900682723',
                'SW1900717390',
                'SW1900682267',
                'SW1900706645',
                'SW1900687223',
                'SW1900707501',
                'SW1900684790',
                'SW1900679267',
                'SW1900704845',
                'SW1900704423',
                'SW1900688245',
                'SW1900705667',
                'SW1900685645',
                'SW1900729901',
                'SW1900706556',
                'SW1900692134',
                'SW1900686167',
                'SW1900685289',
                'SW1900688134',
                'SW1900682312',
                'SW1900678889',
                'SW1900704667',
                'SW1900696145',
                'SW1900686045',
                'SW1900678567',
                'SW1900695745',
                'SW1900687245',
                'SW1900685467',
                'SW1900691823',
                'SW1900685145',
                'SW1900685078',
                'SW1900705734',
                'SW1900682234',
                'SW1900678556',
                'SW1900684934',
                'SW1900686278',
                'SW1900693490',
                'SW1900679356',
                'SW1900706623',
                'SW1900696290',
                'SW1900684923',
                'SW1900684945',
                'SW1900684556',
                'SW1900705645',
                'SW1900688445',
                'SW1900706890',
                'SW1900685590',
                'SW1900691967',
                'SW1900707667',
                'SW1900696234',
                'SW1900718756',
                'SW1900685278',
                'SW1900685178',
                'SW1900684467',
                'SW1900684212',
                'SW1900705701',
                'SW1900688523',
                'SW1900678867',
                'SW1900688178',
                'SW1900689412',
                'SW1900691867',
                'SW1900691201',
                'SW1900705690',
                'SW1900717356',
                'SW1900681390',
                'SW1900695967',
                'SW1900718256',
                'SW1900686323',
                'SW1900691834',
                'SW1900693523',
                'SW1900707212',
                'SW1900682412',
                'SW1900686389',
                'SW1900686545',
                'SW1900679389',
                'SW1900686790',
                'SW1900678989',
                'SW1900705112',
                'SW1900687023',
                'SW1900682423',
                'SW1900706867',
                'SW1900681178',
                'SW1900688189',
                'SW1900686878',
                'SW1900674790',
                'SW1900706290',
                'SW1900682623',
                'SW1900705745',
                'SW1900684734',
                'SW1900685045',
                'SW1900696034',
                'SW1900707123',
                'SW1900691223',
                'SW1900706978',
                'SW1900685234',
                'SW1900696112',
                'SW1900682434',
                'SW1900705078',
                'SW1900706745',
                'SW1900678534',
                'SW1900688456',
                'SW1900684545',
                'SW1900706212',
                'SW1900685767',
                'SW1900691801',
                'SW1900686723',
                'SW1900696256',
                'SW1900704578',
                'SW1900718790',
                'SW1900685367',
                'SW1900718745',
                'SW1900718534',
                'SW1900681223',
                'SW1900720856',
                'SW1900704745',
                'SW1900682801',
                'SW1900706689',
                'SW1900696345',
                'SW1900718656',
                'SW1900705356',
                'SW1900705534',
                'SW1900685567',
                'SW1900718823',
                'SW1900685967',
                'SW1900685523',
                'SW1900682556',
                'SW1900679145',
                'SW1900707034',
                'SW1900693501',
                'SW1900717623',
                'SW1900718834',
                'SW1900685790',
                'SW1900685390',
                'SW1900706434',
                'SW1900686090',
                'SW1900685801',
                'SW1900698989',
                'SW1900684678',
                'SW1900687156',
                'SW1900678723',
                'SW1900707489',
                'SW1900688067',
                'SW1900687056',
                'SW1900685112',
                'SW1900684589',
                'SW1900678523',
                'SW1900686401',
                'SW1900696134',
                'SW1900688212',
                'SW1900681234',
                'SW1900687112',
                'SW1900686678',
                'SW1900717467',
                'SW1900691934',
                'SW1900683990',
                'SW1900691256',
                'SW1900705290',
                'SW1900685601',
                'SW1900695934',
                'SW1900686512',
                'SW1900691467',
                'SW1900679390',
                'SW1900685789',
                'SW1900705789',
                'SW1900684567',
                'SW1900684578',
                'SW1900686456',
                'SW1900688401',
                'SW1900682289',
                'SW1900695690',
                'SW1900681067',
                'SW1900682301',
                'SW1900681190',
                'SW1900685478',
                'SW1900678945',
                'SW1900685501',
                'SW1900679367',
                'SW1900705945',
                'SW1900685990',
                'SW1900687256',
                'SW1900707201',
                'SW1900695456',
                'SW1900688023',
                'SW1900681290',
                'SW1900682523',
                'SW1900684756',
                'SW1900688501',
                'SW1900691945',
                'SW1900695445',
                'SW1900687234',
                'SW1900705867',
                'SW1900685345',
                'SW1900696056',
                'SW1900685434',
                'SW1900696434',
                'SW1900688489',
                'SW1900686601',
                'SW1900691267',
                'SW1900706545',
                'SW1900686445',
                'SW1900706756',
                'SW1900688378',
                'SW1900686689',
                'SW1900684689',
                'SW1900696512',
                'SW1900687190',
                'SW1900684078',
                'SW1900686923',
                'SW1900695756',
                'SW1900705278',
                'SW1900691178',
                'SW1900686089',
                'SW1900691378',
                'SW1900682812',
                'SW1900686801',
                'SW1900679001',
                'SW1900707234',
                'SW1900705345',
                'SW1900681089',
                'SW1900696423',
                'SW1900682767',
                'SW1900684523',
                'SW1900686312',
                'SW1900674801',
                'SW1900686345',
                'SW1900684901',
                'SW1900695823',
                'SW1900717423',
                'SW1900685923',
                'SW1900688112',
                'SW1900687201',
                'SW1900692012',
                'SW1900685678',
                'SW1900686056',
                'SW1900695834',
                'SW1900695890',
                'SW1900691767',
                'SW1900717645',
                'SW1900682601',
                'SW1900686612',
                'SW1900686412',
                'SW1900681367',
                'SW1900684667',
                'SW1900717289',
                'SW1900678656',
                'SW1900696289',
                'SW1900678967',
                'SW1900707289',
                'SW1900691489',
                'SW1900696456',
                'SW1900685445',
                'SW1900705434',
                'SW1900691323',
                'SW1900706534',
                'SW1900686856',
                'SW1900707578',
                'SW1900705934',
                'SW1900685267',
                'SW1900681245',
                'SW1900678812',
                'SW1900678589',
                'SW1900684445',
                'SW1900720834',
                'SW1900681301',
                'SW1900686989',
                'SW1900705478',
                'SW1900688590',
                'SW1900692123',
                'SW1900729923',
                'SW1900688101',
                'SW1900696390',
                'SW1900696401',
                'SW1900685412',
                'SW1900691567',
                'SW1900685589',
                'SW1900717545',
                'SW1900688478',
                'SW1900684156',
                'SW1900682456',
                'SW1900707045',
                'SW1900688423',
                'SW1900705890',
                'SW1900705134',
                'SW1900686334',
                'SW1900681090',
                'SW1900695489',
                'SW1900696601',
                'SW1900705467',
                'SW1900678990',
                'SW1900691545',
                'SW1900687034',
                'SW1900706245',
                'SW1900685689',
                'SW1900682756',
                'SW1900686789',
                'SW1900706390',
                'SW1900696223',
                'SW1900685989',
                'SW1900707267',
                'SW1900684456',
                'SW1900707456',
                'SW1900682545',
                'SW1900685556',
                'SW1900686212',
                'SW1900704978',
                'SW1900706778',
                'SW1900705367',
                'SW1900681145',
                'SW1900707189',
                'SW1900685901',
                'SW1900706734',
                'SW1900691334',
                'SW1900685656',
                'SW1900705589',
                'SW1900684856',
                'SW1900685323',
                'SW1900685023',
                'SW1900689301',
                'SW1900707078',
                'SW1900705634',
                'SW1900691978',
                'SW1900717578',
                'SW1900684845',
                'SW1900704834',
                'SW1900686034',
                'SW1900681312',
                'SW1900704690',
                'SW1900684967',
                'SW1900684834',
                'SW1900682734',
                'SW1900705123',
                'SW1900679123',
                'SW1900705101',
                'SW1900674789',
                'SW1900678734',
                'SW1900705090',
                'SW1900686023',
                'SW1900684912',
                'SW1900691501',
                'SW1900691956',
                'SW1900704589',
                'SW1900705323',
                'SW1900695734',
                'SW1900687090',
                'SW1900692112',
                'SW1900685223',
                'SW1900705790',
                'SW1900717234',
                'SW1900705389',
                'SW1900704767',
                'SW1900678578',
                'SW1900707701',
                'SW1900678712',
                'SW1900692078',
                'SW1900687067',
                'SW1900707012',
                'SW1900684701',
                'SW1900707334',
                'SW1900707290',
                'SW1900685356',
                'SW1900685067',
                'SW1900685123',
                'SW1900678756',
                'SW1900707534',
                'SW1900706901',
                'SW1900686712',
                'SW1900684990',
                'SW1900706634',
                'SW1900707001',
                'SW1900682789',
                'SW1900707345',
                'SW1900695912',
                'SW1900684012',
                'SW1900707689',
                'SW1900717690',
                'SW1900707545',
                'SW1900717312',
                'SW1900692067',
                'SW1900707690',
                'SW1900705956',
                'SW1900691345',
                'SW1900686978',
                'SW1900695667',
                'SW1900685256',
                'SW1900717267',
                'SW1900682512',
                'SW1900678901',
                'SW1900687045',
                'SW1900687089',
                'SW1900679167',
                'SW1900704612',
                'SW1900679234',
                'SW1900686378',
                'SW1900685401',
                'SW1900684956',
                'SW1900717490',
                'SW1900681445',
                'SW1900717534',
                'SW1900696623',
                'SW1900681456',
                'SW1900686889',
                'SW1900687145',
                'SW1900688301',
                'SW1900684089',
                'SW1900706678',
                'SW1900686123',
                'SW1900707512',
                'SW1900704412',
                'SW1900691912',
                'SW1900705001',
                'SW1900688123',
                'SW1900686156',
                'SW1900705845',
                'SW1900688612',
                'SW1900679112',
                'SW1900685090',
                'SW1900688467',
                'SW1900681189',
                'SW1900706345',
                'SW1900691923',
                'SW1900692001',
                'SW1900682334',
                'SW1900678923',
                'SW1900704912',
                'SW1900705089',
                'SW1900684056',
                'SW1900686590',
                'SW1900707467',
                'SW1900717367',
                'SW1900695812',
                'SW1900707278',
                'SW1900688490',
                'SW1900705445',
                'SW1900696090',
                'SW1900705423',
                'SW1900696001',
                'SW1900686012',
                'SW1900706301',
                'SW1900707378',
                'SW1900692034',
                'SW1900679189',
                'SW1900717701',
                'SW1900688290',
                'SW1900685667',
            ];

            $batchSize = 100;
            $count = 0;

            if (200 === $uploadResponse->getStatusCode()) {
                foreach ($uploadResult as $data) {
                    if (isset($data['contract']) && isset($data['contract']['contractNumber']) && !empty($data['contract']['expiryDate'])) {
                        $contract = $this->entityManager->getRepository(Contract::class)->findOneBy(['contractNumber' => $data['contract']['contractNumber']]);

                        if (null !== $contract && \in_array($contract->getContractNumber(), $toPatch, true)) {
                            $lockInDate = new \DateTime($data['contract']['expiryDate'], $this->timezone);
                            $io->text('Contract: '.$contract->getContractNumber().', LockInDate: '.$lockInDate->format('c'));
                            $lockInDate->setTimezone(new \DateTimeZone('UTC'));
                            $contract->setLockInDate($lockInDate);

                            $this->entityManager->persist($contract);
                            ++$count;
                        }

                        if (0 === ($count % $batchSize)) {
                            $this->entityManager->flush();
                            $this->entityManager->clear();
                        }
                    }
                }

                if ($count > 0) {
                    $this->entityManager->flush();
                    $this->entityManager->clear();
                }
            }

            $io->text('Updated '.$count.' contracts.');
        } else {
            $io->text('No file found.');
        }

        return 0;
    }
}
